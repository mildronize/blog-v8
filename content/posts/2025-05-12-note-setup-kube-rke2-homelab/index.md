+++
title = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Kubernetes Cluster ‡∏î‡πâ‡∏ß‡∏¢ RKE2 ‡∏â‡∏ö‡∏±‡∏ö Homelab"
date = "2025-05-12"

[taxonomies]
categories = [ "Kubernetes" ]
tags = [ "Kubernetes", "ubuntu" ]

[extra]
id = "24gzuld"
+++

## ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Homelab ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‚Ä¶‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á PC ‡∏ß‡∏≤‡∏á‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏ß‡πâ 2 ‡∏õ‡∏µ
‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏à‡∏≠ AMD RX6600, CPU AMD 6 Core, RAM 32GB ‡πÅ‡∏ö‡∏ö‡∏™‡πÄ‡∏õ‡∏Å‡∏î‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏∞
‡πÅ‡∏ï‡πà‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Å‡πá‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏±‡∏Å‡∏ó‡∏µ... ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏ï‡πä‡∏∞‡∏ß‡∏≤‡∏á‡∏ù‡∏∏‡πà‡∏ô‡πÑ‡∏õ‡πÄ‡∏â‡∏¢ üòÖ

‡∏Ñ‡∏¥‡∏î‡πÑ‡∏õ‡∏Ñ‡∏¥‡∏î‡∏°‡∏≤...‡πÑ‡∏´‡∏ô ‡πÜ ‡∏Å‡πá‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏•‡∏∞ ‡∏á‡∏±‡πâ‡∏ô‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡∏ó‡∏≥ Homelab ‡∏•‡∏∞‡∏Å‡∏±‡∏ô
‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Ñ‡∏∑‡∏≠ License Windows 11 ‡∏´‡∏≤‡∏¢‡∏à‡πâ‡∏≠‡∏¢ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏≥ Key ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß 5555

{% note(header="Note") %}
‡∏ú‡∏°‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏î‡πâ Setup Linux Server ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡∏ñ‡πâ‡∏≤‡∏ú‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ú‡∏°‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô ‡∏ù‡∏≤‡∏Å‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö
{% end %}

‡∏ô‡∏µ‡πà‡∏î‡∏π‡∏™‡∏¥ Spec ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÜ 
![htop](htop-pc.jpg)

### ‡∏ó‡∏≥‡πÑ‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ RKE2?

‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏±‡∏ô‡∏Å‡πá‡πÄ‡∏¢‡∏≠‡∏∞‡∏ô‡∏∞ ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô:

* `kubeadm` ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Å
* `k3s` ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏≤‡πÅ‡∏ï‡πà‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡πá‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏õ‡πÄ‡∏¢‡∏≠‡∏∞
* ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞ `microk8s`, `kind`, `minikube` ‡∏Å‡πá‡∏°‡∏µ‡∏ô‡∏∞ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ

‡πÅ‡∏ï‡πà‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å RKE2 ‡πÄ‡∏û‡∏£‡∏≤‡∏∞...

üí° ‡∏°‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠ Kubernetes ‡∏ó‡∏µ‡πà:

* ‡∏°‡∏µ **‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö production-grade**
* ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤ `kubeadm` ‡πÄ‡∏¢‡∏≠‡∏∞
* ‡∏°‡∏µ binary ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏ö
* ‡πÉ‡∏ä‡πâ `containerd` ‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Docker
* ‡∏°‡∏µ bundled etcd, kubelet, scheduler ‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö
* ‡πÅ‡∏•‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠... **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Rancher UI ‡∏Å‡πá‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ**

‡πÅ‡∏ñ‡∏° RKE2 ‡∏Å‡πá‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á Rancher (SUSE) ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö `k3s` ‡∏ô‡∏±‡πà‡∏ô‡πÅ‡∏´‡∏•‡∏∞

‡πÅ‡∏ï‡πà‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ **‡πÄ‡∏ô‡πâ‡∏ô production + HA ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤**

‡πÅ‡∏ï‡πà‡∏Å‡πá‡∏ô‡∏∞ Spec ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÜ ‡∏à‡∏∞‡πÉ‡∏ä‡πâ k3s ‡∏Å‡πá‡∏î‡∏π‡∏ñ‡∏π‡∏Å Spec ‡πÑ‡∏õ‡∏´‡∏ô‡πà‡∏≠‡∏¢ 555 ‡πÄ‡∏•‡∏¢‡∏•‡∏≠‡∏á‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤

### ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡∏Å Disk ‡∏î‡πâ‡∏ß‡∏¢ LVM?

‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥ Homelab ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏ä‡∏≠‡∏ö‡∏•‡∏á ‡πÜ ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `/` ‡∏´‡∏°‡∏î‡πÄ‡∏•‡∏¢
‡πÅ‡∏ï‡πà‡∏û‡∏≠‡∏ó‡∏≥‡∏à‡∏£‡∏¥‡∏á ‡∏à‡∏∞‡∏£‡∏π‡πâ‡πÄ‡∏•‡∏¢‡∏ß‡πà‡∏≤:

* etcd ‡∏Å‡∏±‡∏ö container runtime (containerd) ‡∏°‡∏±‡∏ô write ‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å
* log ‡∏Å‡πá‡∏û‡∏∏‡πà‡∏á
* disk ‡πÄ‡∏ï‡πá‡∏° ‚Üí cluster ‡∏û‡∏±‡∏á
* ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞ move/backup volume ‡∏ó‡∏µ‡∏ô‡∏∂‡∏á‡∏Å‡πá‡∏•‡∏≥‡∏ö‡∏≤‡∏Å

‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ **LVM ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ disk ‡πÅ‡∏ö‡∏ö‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô**

* ‡πÅ‡∏¢‡∏Å disk path `/var/lib`, `/opt/kube-data` ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô
* ‡πÄ‡∏≠‡∏≤ `/var/lib` ‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà SSD ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ etcd/containerd ‡πÄ‡∏£‡πá‡∏ß
* ‡∏ó‡∏≥ snapshot, resize, ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡πâ‡∏≤‡∏¢ path ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
* ‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å HDD ‡∏≠‡∏µ‡∏Å‡∏ï‡∏±‡∏ß‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏£‡∏≠‡∏á/‡πÄ‡∏Å‡πá‡∏ö log

### ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ Homelab ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‚Ä¶

* ‚úÖ ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö **production ‡∏à‡∏£‡∏¥‡∏á** (run workload ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ)
* ‚úÖ **Scale** ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï (‡πÄ‡∏û‡∏¥‡πà‡∏° Node ‡∏Å‡πá‡πÑ‡∏î‡πâ)
* ‚úÖ **‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö distro** ‡πÉ‡∏î ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô Rancher UI, k3s-only path
* ‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á‡∏´‡∏°‡∏î
* ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Helm, Longhorn, GitOps, Monitoring ‡πÑ‡∏î‡πâ‡∏´‡∏°‡∏î

‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏Ñ‡∏∑‡∏≠‡∏°‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô ‚Äúkube cluster ‡∏ó‡∏µ‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏à‡πÑ‡∏î‡πâ‚Äù

‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏•‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö production ‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å

## ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Disk / Volume ‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Kubernetes

‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡∏•‡∏á RKE2 ‡∏ú‡∏°‡∏Å‡πá‡∏°‡∏≤‡∏ô‡∏±‡πà‡∏á‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤...
‡πÑ‡∏´‡∏ô ‡πÜ ‡∏Å‡πá‡∏°‡∏µ disk ‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏ó‡∏≥‡πÑ‡∏°‡πÑ‡∏°‡πà‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏ô?

‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á SSD ‡πÅ‡∏•‡∏∞ HDD ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß:

* **SSD (NVMe 1TB)** ‚Üí ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô OS, Database, PVC ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ IOPS
* **HDD (2TB)** ‚Üí ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö log, ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß

‡∏û‡∏≠‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö LVM ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏à‡∏±‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á storage ‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢ üëá

### SSD (NVMe): ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö K8s Core ‡πÅ‡∏•‡∏∞ Data ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß

| Mountpoint       | ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£                                 | Volume      |
| ---------------- | --------------------------------------- | ----------- |
| `/`              | ‡∏ï‡∏±‡∏ß OS Ubuntu                            | `ubuntu-lv` |
| `/var/lib`       | ‡πÄ‡∏Å‡πá‡∏ö state ‡∏Ç‡∏≠‡∏á containerd, etcd, kubelet | `varlib`    |
| `/opt/kube-data` | ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PVC ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß ‡πÄ‡∏ä‡πà‡∏ô PostgreSQL, Redis   | `kubedata`  |

### HDD: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á / Log / Cold Storage

| Mountpoint                       | ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£                       | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏           |
| -------------------------------- | ----------------------------- | ----------------- |
| `/mnt/storage-hdd`               | ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, log, rsync snapshot | ‡∏à‡∏≤‡∏Å `/dev/sda2`   |
| `/mnt/storage-hdd2` *(optional)* | ‡∏™‡∏≥‡∏£‡∏≠‡∏á metadata ‡∏´‡∏£‡∏∑‡∏≠ media file  | `/dev/sda3` ‡∏ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á |

### Logical Volume ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ LVM

| LV Name    | Mountpoint       | ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£                             |
| ---------- | ---------------- | ----------------------------------- |
| `root`     | `/`              | ‡∏£‡∏∞‡∏ö‡∏ö OS                             |
| `varlib`   | `/var/lib`       | ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà K8s ‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏Å ‡πÜ (etcd, containerd) |
| `kubedata` | `/opt/kube-data` | PVC ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Database / Log ‡πÄ‡∏£‡πá‡∏ß ‡πÜ       |

### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Volume ‡∏á‡πà‡∏≤‡∏¢ ‡πÜ

‡∏ú‡∏°‡∏Ñ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡∏ß‡πà‡∏≤...

* ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ K8s ‡πÉ‡∏ä‡πâ path ‡πÅ‡∏ö‡∏ö `rancher/`, `k3s/` ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà "‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö distro"
* ‡∏≠‡∏¢‡∏≤‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ path ‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡∏≤‡∏á ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô `/opt/kube-data` ‡∏´‡∏£‡∏∑‡∏≠ `/var/lib` ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
* ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏¢‡πâ‡∏≤‡∏¢ cluster ‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡∏¢‡πâ‡∏≤‡∏¢ folder ‡∏´‡∏£‡∏∑‡∏≠ LV ‡πÑ‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

‡πÅ‡∏ñ‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á LVM:

* Resize ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
* Snap ‡πÑ‡∏î‡πâ
* ‡πÅ‡∏¢‡∏Å log / etcd ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ disk ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏ß‡∏°‡∏´‡∏±‡∏ß‡∏Å‡∏±‡∏ô

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Use Case ‡∏à‡∏£‡∏¥‡∏á ‡πÜ

| ‡∏á‡∏≤‡∏ô                         | Path                       | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Storage |
| --------------------------- | -------------------------- | -------------- |
| etcd, containerd, kubelet   | `/var/lib`                 | SSD (‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å)   |
| PostgreSQL / Redis PVC      | `/opt/kube-data/postgres`  | SSD            |
| Media uploads / backup logs | `/mnt/storage-hdd/uploads` | HDD            |
| ‡∏™‡∏≥‡∏£‡∏≠‡∏á snapshot               | `/mnt/storage-hdd/backup`  | HDD            |

‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á LV, mount, format ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ RKE2 ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢


## ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ LVM ‡πÅ‡∏¢‡∏Å Disk ‡πÉ‡∏´‡πâ K8s ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏ß ‡πÜ üöÄ

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏•‡∏á Ubuntu 24.04 LTS ‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏ú‡∏°‡∏Å‡πá‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡πÄ‡∏õ‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `lsb_release -a` ‡∏Å‡∏±‡∏ö `uname -a`
‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ kernel ‡πÉ‡∏´‡∏°‡πà ‡πÜ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö LVM ‡∏Å‡∏±‡∏ö container runtime ‡πÑ‡∏î‡πâ‡∏î‡∏µ

```bash
$ lsb_release -a
Distributor ID: Ubuntu
Description:    Ubuntu 24.04.2 LTS
...
$ uname -a
Linux XXXX 6.8.0-59-generic ...
```

‡∏ó‡∏µ‡πà‡∏ú‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡∏≤‡πÉ‡∏ä‡πâ LVM ‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢
‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Disk ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Format ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° volume

### ‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á disk ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô

```bash
$ lsblk
NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
sda                         8:0    0   1.8T  0 disk 
‚îú‚îÄsda1                      8:1    0    16M  0 part 
‚îú‚îÄsda2                      8:2    0 886.4G  0 part 
‚îî‚îÄsda3                      8:3    0 976.6G  0 part 
nvme0n1                   259:0    0 931.5G  0 disk 
‚îú‚îÄnvme0n1p1               259:1    0     1G  0 part /boot/efi
‚îú‚îÄnvme0n1p2               259:2    0     2G  0 part /boot
‚îî‚îÄnvme0n1p3               259:3    0 928.5G  0 part 
  ‚îî‚îÄubuntu--vg-ubuntu--lv 252:0    0   100G  0 lvm  /
```

‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤:

* ‡∏°‡∏µ SSD (nvme0n1) ‡∏Ç‡∏ô‡∏≤‡∏î \~1TB ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏û‡∏≤‡∏£‡πå‡∏ï‡∏¥‡∏ä‡∏±‡∏ô ‡πÉ‡∏ä‡πâ LVM ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
* ‡πÅ‡∏•‡∏∞‡∏°‡∏µ HDD (sda) ‡∏≠‡∏µ‡∏Å 2 ‡∏û‡∏≤‡∏£‡πå‡∏ï‡∏¥‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏ç‡πà ‡πÜ ‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 1.8TB

‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å root (`/`) ‡∏ñ‡∏π‡∏Å mount ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà LV ‡∏ä‡∏∑‡πà‡∏≠ `ubuntu-lv` ‡∏Ç‡∏ô‡∏≤‡∏î 100GB
‡πÅ‡∏•‡∏∞ volume group ‡∏ä‡∏∑‡πà‡∏≠ `ubuntu-vg` ‡∏¢‡∏±‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å‡πÄ‡∏û‡∏µ‡∏¢‡∏ö! ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 828GB üòç

‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡∏™‡∏≥‡∏£‡∏ß‡∏à Volume Group ‡∏ó‡∏µ‡πà Ubuntu ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô

```bash
$ sudo vgdisplay

  --- Volume group ---
  VG Name               ubuntu-vg
  Format                lvm2
  VG Access             read/write
  VG Status             resizable
  VG Size               928.46 GiB
  Alloc PE / Size       25600 / 100.00 GiB
  Free  PE / Size       212085 / 828.46 GiB
```

‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á vgdisplay ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ Ubuntu ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡∏≤‡πÅ‡∏ö‡∏ö‡πÉ‡∏ä‡πâ LVM ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß
‡πÇ‡∏î‡∏¢‡∏°‡∏µ Volume Group ‡∏ä‡∏∑‡πà‡∏≠ ubuntu-vg ‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 928GB

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏Ñ‡πà 100GB ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö / ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏≠‡∏á
‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏µ‡∏Å‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö 830GB ‡πÅ‡∏ö‡∏ö resizable ‡∏î‡πâ‡∏ß‡∏¢
‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á Logical Volume ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏™‡∏ö‡∏≤‡∏¢ ‡πÜ üéâ

### ‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á LVM ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢ üéâ

‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠...

| Mountpoint       | ‡∏Ç‡∏ô‡∏≤‡∏î  | ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£                           |
| ---------------- | ----- | --------------------------------- |
| `/var/lib`       | 100GB | ‡πÄ‡∏Å‡πá‡∏ö state ‡∏Ç‡∏≠‡∏á containerd ‡∏Ø‡∏•‡∏Ø      |
| `/opt/kube-data` | 200GB | PVC / database / log ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ IOPS |

```bash
sudo lvcreate -n varlib -L 100G ubuntu-vg
sudo lvcreate -n kubedata -L 200G ubuntu-vg
```

### Format + Mount ‡∏ó‡∏µ‡∏•‡∏∞‡∏à‡∏∏‡∏î

```bash
# Format
sudo mkfs.ext4 /dev/ubuntu-vg/varlib
sudo mkfs.ext4 /dev/ubuntu-vg/kubedata

# ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå mount
sudo mkdir -p /mnt/varlib /opt/kube-data

# mount ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÉ‡∏ô /var/lib
sudo mount /dev/ubuntu-vg/varlib /mnt/varlib
sudo cp -a /var/lib/* /mnt/varlib/

# ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á
sudo mv /var/lib /var/lib.bak
sudo mkdir /var/lib
sudo mount /dev/ubuntu-vg/varlib /var/lib
```

‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ `/etc/fstab` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ system mount ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á reboot:

```bash
echo '/dev/ubuntu-vg/varlib /var/lib ext4 defaults 0 2' | sudo tee -a /etc/fstab
echo '/dev/ubuntu-vg/kubedata /opt/kube-data ext4 defaults 0 2' | sudo tee -a /etc/fstab
```

### ‡∏à‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà backup ‡∏ö‡∏ô HDD

‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° `/mnt/storage-hdd` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≥‡∏£‡∏≠‡∏á log ‡∏´‡∏£‡∏∑‡∏≠ DB snapshot ‡∏ï‡πà‡∏≤‡∏á ‡πÜ

```bash
sudo mkfs.ext4 /dev/sda2
sudo mkdir -p /mnt/storage-hdd
sudo mount /dev/sda2 /mnt/storage-hdd
echo '/dev/sda2 /mnt/storage-hdd ext4 defaults 0 2' | sudo tee -a /etc/fstab
```

### ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏•‡∏±‡∏á mount

```bash
mount | grep -E '/var/lib|/opt/kube-data|/mnt/storage-hdd'
```

‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤:

* `/var/lib` ‡πÉ‡∏ä‡πâ `varlib` ‡∏à‡∏≤‡∏Å SSD ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏£‡∏¥‡∏á ‡πÜ
* `/opt/kube-data` ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
* `/mnt/storage-hdd` ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏£‡∏≠‡∏á log ‡πÅ‡∏•‡πâ‡∏ß

### ‡∏™‡∏£‡∏∏‡∏õ Logical Volume ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ

```bash
$ sudo lvs
LV        VG         LSize
ubuntu-lv ubuntu-vg  100.00g  (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö /)
varlib    ubuntu-vg  100.00g  (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö /var/lib)
kubedata  ubuntu-vg  200.00g  (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö /opt/kube-data)
```

‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô VG (`ubuntu-vg`) ‡∏≠‡∏µ‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **528GB**
‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å

‡∏î‡∏π mountpoint ‡∏î‡πâ‡∏ß‡∏¢:

```bash
$ lsblk -o NAME,SIZE,FSTYPE,MOUNTPOINT,LABEL

NAME                        SIZE FSTYPE      MOUNTPOINT       LABEL
sda                         1.8T                              
‚îú‚îÄsda1                       16M                              
‚îú‚îÄsda2                    886.4G ext4        /mnt/storage-hdd 
‚îî‚îÄsda3                    976.6G ntfs                         Entertain
nvme0n1                   931.5G                              
‚îú‚îÄnvme0n1p1                   1G vfat        /boot/efi        
‚îú‚îÄnvme0n1p2                   2G ext4        /boot            
‚îî‚îÄnvme0n1p3               928.5G LVM2_member                  
  ‚îú‚îÄubuntu--vg-ubuntu--lv   100G ext4        /                
  ‚îú‚îÄubuntu--vg-varlib       100G ext4        /var/lib         
  ‚îî‚îÄubuntu--vg-kubedata     200G ext4        /opt/kube-data   
```

‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡πá ‡∏ó‡∏î‡∏™‡∏≠‡∏ö reboot ‡∏™‡∏±‡∏Å‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ mount ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

```bash
$ mount | grep -E '/var/lib|/opt/kube-data|/mnt/storage-hdd'
/dev/mapper/ubuntu--vg-kubedata on /opt/kube-data type ext4 (rw,relatime)
/dev/mapper/ubuntu--vg-varlib on /var/lib type ext4 (rw,relatime)
/dev/sda2 on /mnt/storage-hdd type ext4 (rw,relatime)
```
‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ mount ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÑ‡∏ß‡πâ

## ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á RKE2 ‡∏ö‡∏ô Ubuntu

‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á RKE2 ‡∏ö‡∏ô Ubuntu 24.04 LTS

### 1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Binary ‡∏Ç‡∏≠‡∏á RKE2

RKE2 ‡πÉ‡∏ä‡πâ installer ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏ö‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡∏Å‡∏•‡∏á kubelet, etcd ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ß‡∏∏‡πà‡∏ô‡∏ß‡∏≤‡∏¢
‡πÅ‡∏Ñ‡πà‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á

```bash
curl -sfL https://get.rke2.io | sudo sh -
```

‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î binary ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `/usr/local` ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö systemd service ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏•‡∏¢

### 2. Enable ‡πÅ‡∏•‡∏∞ Start Service

```bash
sudo systemctl enable rke2-server.service
sudo systemctl start rke2-server.service
```

> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πâ‡∏≤‡∏°‡∏µ error ‡∏ï‡∏≠‡∏ô `start` ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏î‡∏π log ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

### 3. ‡∏î‡∏π Log Realtime

‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠ service ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏ú‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î log ‡∏î‡∏π‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡∏¢:

```bash
sudo journalctl -u rke2-server -f
```

‡∏ñ‡πâ‡∏≤ service ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏à‡∏∞‡πÄ‡∏à‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ô‡∏µ‡πâ:

```text
Remotedialer connected to proxy
Adding node <‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á> etcd status condition
Tunnel authorizer set Kubelet Port 0.0.0.0:10250
```

üïê ‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 1‚Äì2 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ï‡∏≠‡∏ô‡∏£‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î container image ‡∏ï‡πà‡∏≤‡∏á ‡πÜ

### 4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Node ‡∏î‡πâ‡∏ß‡∏¢ kubectl

RKE2 ‡∏à‡∏∞‡∏°‡∏µ `kubectl` ‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô path:
`/var/lib/rancher/rke2/bin/kubectl`

‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ `kubectl` ‡πÉ‡∏ô system path ‡∏Å‡πá‡∏™‡∏£‡πâ‡∏≤‡∏á symlink ‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `/usr/local/bin` ‡πÄ‡∏•‡∏¢:

```bash
sudo ln -s /var/lib/rancher/rke2/bin/kubectl /usr/local/bin/kubectl
```

‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô:

```bash
kubectl get nodes
```

‡∏ñ‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ üéâ

```text
NAME       STATUS   ROLES                       AGE   VERSION
homelab    Ready    control-plane,etcd,master   3m    v1.31.x+rke2r1
```

**‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ**

* RKE2 ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
* kubectl ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á server
* node status ‡πÄ‡∏õ‡πá‡∏ô Ready ‡πÅ‡∏•‡πâ‡∏ß

 ## ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `kubectl` ‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Mac ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ RKE2

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å RKE2 ‡∏™‡∏£‡πâ‡∏≤‡∏á cluster ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
‡∏à‡∏∞‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∑‡πà‡∏≠ `rke2.yaml` ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà:

```bash
/etc/rancher/rke2/rke2.yaml
```

‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ **kubeconfig** ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏±‡πà‡∏á `kubectl` ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ cluster ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô cert-based admin user ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏ï‡πá‡∏° ‚ö†Ô∏è

 ### 1. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å `rke2.yaml` ‡∏°‡∏≤‡∏ó‡∏µ‡πà home directory

```bash
sudo cp /etc/rancher/rke2/rke2.yaml /home/<your-user>/rke2.yaml
sudo chown <your-user>:<your-user> /home/<your-user>/rke2.yaml
```

> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `<your-user>` ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á user ‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á

 ### 2. ‡∏à‡∏≤‡∏Å Mac ‡πÉ‡∏ä‡πâ `scp` ‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤

```bash
scp -i ~/.ssh/my_home_lab/id_rsa <user>@<ip-server>:/home/<user>/rke2.yaml ~/.kube/rke2.yaml
```

‡πÄ‡∏ä‡πà‡∏ô:

```bash
scp -i ~/.ssh/my_home_lab/id_rsa thadawth@192.168.1.107:/home/thadawth/rke2.yaml ~/.kube/rke2.yaml
```

 ### 3. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ context/cluster/user ‡∏î‡πâ‡∏ß‡∏¢ `yq` ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô `rke2.yaml` ‡∏à‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ `default` ‡∏´‡∏°‡∏î‡πÄ‡∏•‡∏¢
‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡πÄ‡∏ó‡πà ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô:

* context ‚Üí `my_homelab`
* cluster ‚Üí `my_homelab-cluster`
* user ‚Üí `my_homelab-user`

‡∏ú‡∏°‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° script ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏¢ `rename-kubeconfig.sh`

```bash
#!/bin/bash

# üìå ‡∏£‡∏±‡∏ö argument
CONTEXT_NAME="$1"
CLUSTER_NAME="$2"
USER_NAME="$3"
KUBECONFIG_PATH="$HOME/.kube/rke2.yaml"

# ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input
if [[ -z "$CONTEXT_NAME" || -z "$CLUSTER_NAME" || -z "$USER_NAME" ]]; then
  echo "‚ùå Usage: $0 <context_name> <cluster_name> <user_name>"
  exit 1
fi

# ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ yq ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß
if ! command -v yq &> /dev/null; then
  echo "‚ùå 'yq' not found. Install it with 'brew install yq'"
  exit 1
fi

echo "üîß Updating kubeconfig: $KUBECONFIG_PATH"
echo "‚û°Ô∏è  Context: $CONTEXT_NAME"
echo "‚û°Ô∏è  Cluster: $CLUSTER_NAME"
echo "‚û°Ô∏è  User: $USER_NAME"

# üîÅ ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î in-place
yq -i "(.clusters[] | select(.name == \"default\") | .name) = \"$CLUSTER_NAME\"" "$KUBECONFIG_PATH"
yq -i "(.clusters[] | select(.name == \"$CLUSTER_NAME\") | .cluster.server) = \"https://192.168.1.107:6443\"" "$KUBECONFIG_PATH"
yq -i "(.users[] | select(.name == \"default\") | .name) = \"$USER_NAME\"" "$KUBECONFIG_PATH"
yq -i "(.contexts[] | select(.name == \"default\") | .name) = \"$CONTEXT_NAME\"" "$KUBECONFIG_PATH"
yq -i "
  (.contexts[] | select(.name == \"$CONTEXT_NAME\") | .context.cluster) = \"$CLUSTER_NAME\" |
  (.contexts[] | select(.name == \"$CONTEXT_NAME\") | .context.user) = \"$USER_NAME\"
" "$KUBECONFIG_PATH"
yq -i ".current-context = \"$CONTEXT_NAME\"" "$KUBECONFIG_PATH"

echo "‚úÖ Done! You can now merge it into ~/.kube/config with:"
echo "   KUBECONFIG=~/.kube/config:$KUBECONFIG_PATH kubectl config view --flatten > /tmp/config && mv /tmp/config ~/.kube/config"
```
‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡πá‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå execute ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö script

```bash
chmod +x rename-kubeconfig.sh
./rename-kubeconfig.sh my_homelab my_homelab-cluster my_homelab-defaultUser
```

 ### 4. ‡∏£‡∏ß‡∏° `rke2.yaml` ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö kubeconfig ‡∏´‡∏•‡∏±‡∏Å

```bash
export KUBECONFIG=~/.kube/config:~/.kube/rke2.yaml
kubectl config view --flatten > /tmp/kubeconfig-merged.yaml
cp ~/.kube/config ~/.kube/config.bak
mv /tmp/kubeconfig-merged.yaml ~/.kube/config
```

‡∏•‡∏≠‡∏á‡∏î‡∏π‡∏ß‡πà‡∏≤ context ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏°‡∏±‡πâ‡∏¢:

```bash
kubectl config get-contexts
CURRENT   NAME                     CLUSTER                  AUTHINFO                                               NAMESPACE
           my_homelab               my_homelab-cluster       my_homelab-defaultUser                                 
*          rancher-desktop          rancher-desktop          rancher-desktop       
```

‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏™‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ `rancher-desktop` ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏´‡∏ô‡∏ô‡∏∞ ‡∏û‡∏≠‡∏ú‡∏°‡πÉ‡∏ä‡πâ `rancher-desktop` ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢

 ### 5. ‡∏ï‡∏±‡πâ‡∏á context ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ default

```bash
$ kubectl config use-context my_homelab
```

‡∏•‡∏≠‡∏á‡∏î‡∏π‡∏ß‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÑ‡∏î‡πâ‡∏°‡∏±‡πâ‡∏¢:

```bash
$ kubectl get nodes
NAME       STATUS   ROLES                       AGE   VERSION
USER   Ready    control-plane,etcd,master   66m   v1.31.8+rke2r1
```

‡πÄ‡∏¢‡πâ üéâ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô node ‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å Mac ‡∏Å‡πá‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!

## Deploy ‡πÅ‡∏≠‡∏õ‡πÅ‡∏£‡∏Å‡∏ö‡∏ô RKE2: NGINX üßë‚Äçüç≥

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ deploy nginx ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠:

* ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ cluster ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á
* ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á deploy ‡πÅ‡∏ö‡∏ö basic
* ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ `kubectl`, `svc`, ‡πÅ‡∏•‡∏∞ `port-forward`

### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `nginx-deploy.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:stable
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app: nginx
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
```

> üì¶ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á `Deployment` ‡πÅ‡∏•‡∏∞ `Service` ‡πÅ‡∏ö‡∏ö ClusterIP

### 2. Apply manifest

```bash
kubectl apply -f nginx-deploy.yaml
```

### 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞

```bash
kubectl get deploy,pods,svc
```

‡∏ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ:

```text
NAME                                READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx-deployment   1/1     1            1           15s

NAME             TYPE        CLUSTER-IP      PORT(S)   AGE
nginx-service    ClusterIP   10.43.XXX.XXX   80/TCP    15s
```

### 4. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô Mac ‡∏î‡πâ‡∏ß‡∏¢ `port-forward` (‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

```bash
kubectl port-forward svc/nginx-service 8080:80
```

‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î browser ‡πÑ‡∏õ‡∏ó‡∏µ‡πà:

```
http://localhost:8080
```

> ‡πÄ‡∏¢‡πâ\~ ‡∏à‡∏∞‡πÄ‡∏à‡∏≠‡∏´‡∏ô‡πâ‡∏≤ ‚ÄúWelcome to nginx!‚Äù ‡πÅ‡∏•‡πâ‡∏ß üéâ

![](nginx-up.png)

## ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Security: ‡∏£‡∏∞‡∏ß‡∏±‡∏á rke2.yaml ‡πÉ‡∏´‡πâ‡∏î‡∏µ

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ copy `rke2.yaml` ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ö‡∏ô Mac ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ cluster ‡πÑ‡∏î‡πâ ‚Äî ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å!
‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡πÑ‡∏ß‡πâ‡∏ß‡πà‡∏≤...

> ‚ö†Ô∏è ‡πÑ‡∏ü‡∏•‡πå `rke2.yaml` ‡∏Ñ‡∏∑‡∏≠ **admin cert ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö**
> ‡πÉ‡∏Ñ‡∏£‡πÑ‡∏î‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ = ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ root access ‡∏ö‡∏ô Kubernetes cluster ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô cert ‡πÅ‡∏ö‡∏ö client certificate ‡∏ó‡∏µ‡πà‡∏ù‡∏±‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `user.client-certificate-data`
‡∏ã‡∏∂‡πà‡∏á RKE2 auto-generate ‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏™‡∏∏‡∏î ‡πÜ
‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡πÅ‡∏á‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ä‡∏£‡πå cluster ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ä‡πâ ‚Üí ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠

### ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÅ‡∏¢‡∏Å ServiceAccount ‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

‡πÉ‡∏ô Kubernetes ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á user ‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏ú‡πà‡∏≤‡∏ô ServiceAccount
‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏≤ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö cert ‡πÄ‡∏≠‡∏á‡πÄ‡∏•‡∏¢

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏™‡∏£‡πâ‡∏≤‡∏á `admin-user` ‡πÅ‡∏ö‡∏ö read/write

```bash
kubectl create serviceaccount admin-user -n kube-system
kubectl create clusterrolebinding admin-user-binding \
  --clusterrole=cluster-admin \
  --serviceaccount=kube-system:admin-user
```

> ‡∏™‡∏£‡πâ‡∏≤‡∏á account ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö cluster-admin

### ‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠

```bash
kubectl -n kube-system create token admin-user
```

‡∏à‡∏∞‡πÑ‡∏î‡πâ token string ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö `kubectl config` ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡πÉ‡∏ô CI/CD ‡∏Å‡πá‡πÑ‡∏î‡πâ

### ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£?

| ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå    | ‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏î‡∏µ                |
| ----------- | ------------------------ |
| ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß | ‡πÉ‡∏ä‡πâ `rke2.yaml` ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‚úÖ   |
| ‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ä‡πâ | ‡∏™‡∏£‡πâ‡∏≤‡∏á ServiceAccount ‡πÅ‡∏¢‡∏Å  |
| ‡∏ó‡∏≥‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á    | ‡πÉ‡∏ä‡πâ OIDC ‡∏´‡∏£‡∏∑‡∏≠ cert-manager |

## ‡∏™‡πà‡∏á‡∏ó‡πâ‡∏≤‡∏¢: ‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏≠‡∏ô‡πÄ‡∏â‡∏¢ ‡πÜ ‚Üí Cluster ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á

‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‚ÄúPC ‡∏ß‡∏≤‡∏á‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏ß‡πâ 2 ‡∏õ‡∏µ‚Äù ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô **Kubernetes Cluster ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô**
‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢ ‚Äî ‡πÄ‡∏£‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£:

- ‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Ubuntu ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ disk ‡∏î‡πâ‡∏ß‡∏¢ LVM
- ‚úÖ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (‡πÄ‡∏£‡πá‡∏ß / ‡πÉ‡∏´‡∏ç‡πà / ‡∏™‡∏≥‡∏£‡∏≠‡∏á)
- ‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á RKE2 ‡πÅ‡∏•‡∏∞ config ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Mac ‡πÑ‡∏î‡πâ
- ‚úÖ deploy nginx ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ‡πÅ‡∏£‡∏Å‡∏ö‡∏ô cluster
- ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ß‡∏≤‡∏á‡∏£‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á security, user ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà setup ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏ö
‡πÅ‡∏ï‡πà‡∏°‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á ‚Äú‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‚Äù ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡πÑ‡∏Å‡∏•‡∏°‡∏≤‡∏Å üéØ

## ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏à‡∏∞‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?

‡πÉ‡∏ô Part ‡∏ï‡πà‡∏≠ ‡πÜ ‡πÑ‡∏õ ‡∏ú‡∏°‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡∏•‡∏∏‡∏¢‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏ï‡πá‡∏° ‡πÄ‡∏ä‡πà‡∏ô...

> * üåê ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Ingress Controller ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏≠‡∏õ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö domain name
> * üîê ‡∏ß‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö User / RBAC ‡πÉ‡∏´‡πâ‡πÅ‡∏ä‡∏£‡πå cluster ‡πÅ‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
> * üì¶ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Helm, CSI Storage (Longhorn), ‡πÅ‡∏•‡∏∞ GitOps
> * üìä Monitoring / Logging ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà production ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ
>  * üîÑ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö CI/CD ‡∏à‡∏≤‡∏Å GitHub

‡∏õ.‡∏•. ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏ù‡∏±‡∏ô‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ ‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏•‡∏∞‡∏Å‡∏±‡∏ô‡∏ô‡∏∞ ‡∏≠‡∏¥‡∏≠‡∏¥

‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Part ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ô‡∏∞ üí¨
‡∏ñ‡πâ‡∏≤‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏ï‡∏≤‡∏° ‡∏ú‡∏°‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á (‡∏°‡∏±‡πâ‡∏á‡∏ô‡∏∞) ‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏∏‡∏Å‡∏°‡∏≤‡∏Å‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô üíô

‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô‡∏ï‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤! üòÑ‚ú®
